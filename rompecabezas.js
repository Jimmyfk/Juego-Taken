class Rompecabezas{constructor(t){this.tabla=[],this.contador=0,this.victorias=0,this.noVictorias=0,this.setTimeout=!1,this.timeout=null,this.inicializar(t),this.startTime=(new Date).getTime()}inicializar(t){this.tabla=[],this.size=t;for(let i=0;i<t;i++){this.tabla[i]=[];for(let e=0;e<t;e++)this.tabla[i][e]=null}for(this.trampa=!1,this.llenar();!this.tieneSolucion();)this.llenar();this.visualizar()}getTime(){return(new Date).getTime()-this.startTime}llenar(){let t=[];for(let i=0;i<this.size;i++)for(let e=0;e<this.size;e++){let s;do{s=Math.floor(Math.random()*this.size**2)}while(t[s]);t[s]=1,this.tabla[i][e]=0===s?null:s}}tieneSolucion(){const t=this.contarIntercambios(),i=this.buscarNull();return 1&this.size||1&i?!(1&t):1&t}contarIntercambios(){let t=0;for(let i=0;i<this.size-1;i++)for(let e=i+1;e<this.size;e++)this.tabla[e]&&this.tabla[i]&&this.tabla[i]>this.tabla[e]&&t++;return t}movimiento(t,i){if(t>0&&null===this.tabla[t-1][i]||t<this.size-1&&null===this.tabla[t+1][i]||i>0&&null===this.tabla[t][i-1]||i<this.size-1&&null===this.tabla[t][i+1]){const e=this.tabla[t][i];this.tabla[t][i]=null,t>0&&null===this.tabla[t-1][i]?this.tabla[t-1][i]=e:t<this.size-1&&null===this.tabla[t+1][i]?this.tabla[t+1][i]=e:i>0&&null===this.tabla[t][i-1]?this.tabla[t][i-1]=e:i<this.size-1&&null===this.tabla[t][i+1]&&(this.tabla[t][i+1]=e)}this.contador++,this.visualizar()}comprobarFinal(){this.isSolved()&&(this.trampa?(this.noVictorias++,this.trampa=!1):this.victorias++,this.timeoutSet?clearTimeout(this.timeout):(this.timeoutSet=!0,this.timeout=setTimeout((()=>{confirm("Has ganado ¿Reiniciar?")&&this.reiniciar(this.size),this.timeoutSet=!1}),200)))}reiniciar(t){let i=document.getElementsByTagName("table")[0];document.getElementsByTagName("main")[0].removeChild(i),this.startTime=(new Date).getTime(),this.contador=0,this.inicializar(t),document.getElementById("wins").innerHTML="Victorias: "+this.victorias,this.noVictorias&&(document.getElementById("nowin").innerHTML="Victorias trucadas: "+this.noVictorias)}visualizar(){let t=document.getElementsByTagName("table")[0];t||(t=document.createElement("table"),document.getElementsByTagName("main")[0].appendChild(t)),t.innerHTML="";for(let i=0;i<this.size;i++){const e=document.createElement("tr");for(let t=0;t<this.size;t++){const s=document.createElement("td");s.setAttribute("id",i*this.size+t.toLocaleString()),s.setAttribute("onclick","rompecabezas.movimiento("+i+", "+t+")"),e.appendChild(s),s.innerHTML=this.tabla[i][t]||"&nbsp;"}t.appendChild(e)}const i=document.createElement("caption");i.innerHTML="Nº de movimientos: "+this.contador,t.insertBefore(i,t.firstChild),this.tiempo(),this.comprobarFinal()}tiempo(){const t=this,i=new Date(this.getTime()),e=i.getUTCHours()+":"+this.comprobarNum(i.getUTCMinutes())+":"+this.comprobarNum(i.getUTCSeconds());document.getElementsByTagName("caption")[0].innerHTML=`Nº de movimientos: ${t.contador} Tiempo: ${e}`,setInterval((function(){t.tiempo()}),100)}buscarNull(){for(let t=this.size-1;t>=0;t--)for(let i=this.size-1;i>=0;i--)if(!this.tabla[t][i])return this.size-t}trucar(){this.tabla=this.getSolvedState(),this.trampa=!0,this.visualizar()}getSolvedState(){let t=[];for(let i=0;i<this.size;i++){t[i]=[];for(let e=0;e<this.size;e++)t[i][e]=i*this.size+e+1}return t[this.size-1][this.size-1]=null,t}compare(t,i){if(!t||!i)return!1;for(let e=0;e<this.size;e++)for(let s=0;s<this.size;s++)if(t[e][s]!==i[e][s])return!1;return!0}isSolved(){const t=this.getSolvedState();return this.compare(this.tabla,t)}comprobarNum(t){return t<10?"0"+t:t}}
